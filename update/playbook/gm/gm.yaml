- name: 复制文件
  copy:
    src: /data/update/app/
    dest: /data/{{ gm_item }}/
    mode: '0644'
    directory_mode: '0755'
  tags: increment

- name: 过滤 {{ gm_item }} 进程
  shell: pgrep -af '/data/{{ gm_item }}/p8_app_server'
  register: gm_item
  ignore_errors: yes

- name: Reload gm 进程（若存在）
  shell: "./server.sh reload"
  args:
    chdir: "/data/{{ gm_item }}/"
  when: gm_item.rc == 0

- name: 睡 1 秒
  pause:
    seconds: 1